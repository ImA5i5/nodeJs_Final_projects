<!-- views/pages/client/review-form.ejs -->
<div class="p-6 max-w-xl mx-auto">
  <h1 class="text-3xl font-bold text-green-700 mb-4">
    ⭐ Leave a Review for <%= project.hiredFreelancer.fullName %>
  </h1>

  <form id="reviewForm" class="bg-white border border-gray-200 rounded-lg shadow-lg p-6">
    <input type="hidden" name="projectId" value="<%= project._id %>" />

    <!-- Rating -->
    <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-2">Rating</label>
      <div id="starContainer" class="flex space-x-1 cursor-pointer text-2xl">
        <% for (let i = 1; i <= 5; i++) { %>
          <span data-value="<%= i %>" class="text-gray-300 hover:text-yellow-500">★</span>
        <% } %>
      </div>
      <input type="hidden" name="rating" id="rating" required />
    </div>

    <!-- Comment -->
    <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-2">Your Feedback</label>
      <textarea
        name="comment"
        class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none"
        rows="5"
        placeholder="Describe your experience working with this freelancer..."
        required
      ></textarea>
    </div>

    <button
      type="submit"
      class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-lg transition"
    >
      Submit Review
    </button>
  </form>
</div>

<script>
const stars = document.querySelectorAll("#starContainer span");
const ratingInput = document.getElementById("rating");

stars.forEach((star) => {
  star.addEventListener("click", () => {
    const value = star.getAttribute("data-value");
    ratingInput.value = value;

    stars.forEach((s, i) => {
      s.classList.toggle("text-yellow-500", i < value);
      s.classList.toggle("text-gray-300", i >= value);
    });
  });
});

document.getElementById("reviewForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const jsonData = Object.fromEntries(formData.entries());

  try {
    const res = await fetch("/review/client/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(jsonData),
    });

    const data = await res.json();
    alert(data.message);

    if (data.success) {
      location.href = "/review/client";
    }
  } catch (err) {
    alert("Failed to submit review.");
  }
});
</script>
