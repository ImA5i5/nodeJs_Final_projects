<!-- views/pages/client/manage-project.ejs -->
 <div class="p-8">

  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-green-700">
      ğŸ“ˆ Manage Project: <%= project.title %>
    </h1>

    <a href="/client/manage/list"
       class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
      ğŸ“‹ Manage All Projects
    </a>
  </div>

  <!-- Project Details -->
  <div class="bg-white p-6 rounded-lg shadow mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Project Details</h2>

    <p class="text-gray-600"><strong>Freelancer:</strong> 
      <%= project.hiredFreelancer?.fullName || "Not assigned" %>
    </p>
    <p class="text-gray-600"><strong>Budget:</strong> â‚¹<%= project.budget %></p>
    <p class="text-gray-600"><strong>Duration:</strong> <%= project.duration %></p>

    <p class="text-gray-600">
      <strong>Status:</strong>
      <span class="capitalize text-green-700"><%= project.status %></span>
    </p>
  </div>

  <!-- Milestones -->
  <div class="bg-green-50 p-6 rounded-lg shadow mb-8">
    <h2 class="text-lg font-semibold text-green-700 mb-4">ğŸ“Š Project Progress</h2>

    <div class="w-full bg-gray-200 rounded-full h-3 mb-3">
      <div class="bg-green-600 h-3 rounded-full"
           style="width: <%= progress %>%"></div>
    </div>

    <p class="text-sm text-gray-600">Progress: <%= progress %>%</p>

    <% if (milestones.length > 0) { %>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
        <% milestones.forEach(m => { %>
          <div class="bg-white p-4 rounded shadow border">
            <h3 class="font-semibold"><%= m.title %></h3>
            <p class="text-sm text-gray-600">Due: <%= new Date(m.dueDate).toLocaleDateString() %></p>
            <p class="text-sm">
              Status:
              <span class="<%= m.status === 'released' ? 'text-green-700' : 'text-yellow-600' %>">
                <%= m.status %>
              </span>
            </p>
          </div>
        <% }); %>
      </div>
    <% } else { %>
      <p class="text-gray-500 mt-2">No milestones available.</p>
    <% } %>
  </div>

  <!-- Chat Section -->
  <div class="bg-white p-6 rounded-lg shadow mb-8">
    <h2 class="text-lg font-semibold text-green-700 mb-4">ğŸ’¬ Communication</h2>
    <p class="text-gray-600 mb-3">
      Chat with your freelancer here:
      <a href="/client/chat" class="text-green-600 underline">Chat Room</a>
    </p>
  </div>

  <!-- Deliverables Upload -->
  <div class="bg-white p-6 rounded-lg shadow mb-8">
    <h2 class="text-lg font-semibold text-green-700 mb-4">ğŸ“ Deliverables</h2>

    <form id="deliverableForm" enctype="multipart/form-data">
      <input type="file" name="deliverables" multiple class="border p-2 w-full mb-3">
      <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
        â¬†ï¸ Upload Files
      </button>
    </form>

    <ul id="uploadedFiles" class="mt-4 text-sm text-gray-600"></ul>
  </div>

  <!-- Actions -->
  <div class="bg-white p-6 rounded-lg shadow flex gap-4 justify-end">
    <button id="approveBtn"
      class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
      âœ… Approve Work
    </button>

    <button id="revisionBtn"
      class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">
      ğŸ” Request Revision
    </button>

    <button id="closeBtn"
      class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
      ğŸš« Close Project
    </button>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const projectId = "<%= project._id %>";

  // Approve
  document.getElementById("approveBtn").onclick = async () => {
    if (!confirm("Approve this project?")) return;

    const res = await fetch(`/project/client/${projectId}/approve`, { method: "PUT" });
    const data = await res.json();
    alert(data.message);
    if (data.success) location.reload();
  };

  // Revision
  document.getElementById("revisionBtn").onclick = async () => {
    const res = await fetch(`/project/client/${projectId}/revision`, { method: "PUT" });
    const data = await res.json();
    alert(data.message);
  };

  // Close
  document.getElementById("closeBtn").onclick = async () => {
    if (!confirm("Close this project?")) return;

    const res = await fetch(`/project/client/${projectId}/close`, { method: "PUT" });
    const data = await res.json();
    alert(data.message);
    if (data.success) location.reload();
  };
});
</script>
