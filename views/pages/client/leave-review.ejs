<!-- views/pages/client/leave-review.ejs -->
<div class="max-w-3xl mx-auto bg-white p-6 mt-10 shadow rounded-lg">
  <h2 class="text-2xl font-bold text-green-700 mb-4">
    ⭐ Leave a Review for <%= project.hiredFreelancer.fullName %>
  </h2>

  <p class="text-gray-600 mb-6">
    Project: <b><%= project.title %></b>
  </p>

  <!-- Review Form -->
  <form id="reviewForm">
    <input type="hidden" name="projectId" value="<%= project._id %>" />

    <!-- Rating -->
    <label class="font-semibold">Rating:</label>
    <div class="flex text-3xl cursor-pointer mb-4" id="ratingStars">
      <% for(let i=1;i<=5;i++){ %>
        <span data-value="<%= i %>" class="star text-gray-300">★</span>
      <% } %>
    </div>
    <input type="hidden" name="rating" id="ratingInput" required />

    <!-- Feedback -->
    <textarea
      name="feedback"
      rows="4"
      required
      placeholder="Write your feedback..."
      class="w-full border p-3 rounded mb-4"
    ></textarea>

    <!-- Tags -->
    <input
      name="tags"
      placeholder="Tags: fast delivery, professional (optional)"
      class="w-full border p-3 rounded mb-4"
    />

    <button
      class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold"
      type="submit">
      ✅ Submit Review
    </button>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
/* ⭐ Star Rating */
let rating = 0;
document.querySelectorAll(".star").forEach(star => {
  star.addEventListener("click", () => {
    rating = star.dataset.value;
    document.getElementById("ratingInput").value = rating;

    document.querySelectorAll(".star").forEach(s => {
      s.classList.remove("text-yellow-400");
      if (s.dataset.value <= rating) s.classList.add("text-yellow-400");
    });
  });
});

/* ✅ Submit Review */
document.getElementById("reviewForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = Object.fromEntries(new FormData(e.target).entries());

  const res = await fetch("/review/submit", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const result = await res.json();

  if (result.success) {
    Swal.fire("✅ Review Submitted!", result.message, "success")
      .then(() => location.href = `/review/view/${data.projectId}`);
  } else {
    Swal.fire("❌ Error", result.message, "error");
  }
});
</script>
